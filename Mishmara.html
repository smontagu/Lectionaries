<!DOCTYPE HTML>
<html>
  <head>
    <meta charset=utf-8>
    <title>Mishmara links</title>
    <script type="text/javascript">
     const Mishmara = [
       [
         ["'Parashat Bereshit'", "בראשית"],
         ["'Joshua.1-11'", "יהושע א עד יא"],
         ["'Psalms.1-11'", "תהלים א עד יא"],
         ["'Mishnah Chagigah'", "חגיגה"]
       ],
       [
         ["'Parashat Noach'", "נח"],
         ["'Joshua.12-19'", "יהושע יב עד יט"],
         ["'Psalms.12-20'", "תהלים יב עד כ"],
         ["'Mishnah Kinnim'", "קנים"]
       ],
       [
         ["'Parashat Lech Lecha'", "לך לך"],
         ["'Joshua.20-24'", "יהושע כ עד סופו"],
         ["'Psalms.21-34'", "תהלים כא עד לד"],
         ["'Mishnah Maasrot', 'Mishnah Maaser Sheni'", "מעשרות<br>מעשר שני"],
       ],
       [
         ["'Parashat Vayera'", "וירא"],
         ["'Judges.1-11'", "שופטים א עד יא"],
         ["'Psalms.35-42'", "תהלים לה עד מב"],
         ["'Mishnah Peah'", "פאה"]
       ],
       [
         ["'Parashat Chayei Sara'", "חיי שרה"],
         ["'Judges.12-21'", "שופטים יב עד סופו"],
         ["'Psalms.43-51'", "תהלים מג עד נא"],
         ["'Mishnah Kiddushin'", "קידושין"],
       ],
       [
         ["'Parashat Toldot'", "תולדות"],
         ["'I Samuel.1-8'", "שמואל א עד ח"],
         ["'Psalms.52-65'", "תהלים נב עד סה"],
         ["'Mishnah Berachot'", "ברכות"],
       ],
       [
         ["'Parashat Vayetzei'", "ויצא"],
         ["'I Samuel.9-13'", "שמואל א ט עד יג"],
         ["'Psalms.66-73'", "תהלים סו עד עג"],
         ["'Mishnah Ketubot'", "כתובות"],
       ],
       [
         ["'Parashat Vayishlach'", "וישלח"],
         ["'I Samuel.14-25'", "שמואל א יד עד כה"],
         ["'Psalms.74-79'", "תהלים עז עד עט"],
         ["'Mishnah Moed Katan', 'Mishnah Horayot'", "מועד קטן<br>הוריות"]
       ],
       [
         ["'Parashat Vayeshev'", "וישב"],
         ["'I Samuel.26-31'", "שמואל א כו עד סופו"],
         ["'Psalms.80-90'", "תהלים פ עד צ"],
         ["'Mishnah Yevamot'", "יבמות"]
       ],
       [
         ["'Parashat Miketz'", "מקץ"],
         ["'II Samuel.1-18'", "שמואל ב א עד יח"],
         ["'Psalms.91-106'", "תהלים צא עד קו"],
         ["'Mishnah Mikvaot'", "מקואות"]
       ],
       [
         ["'Parashat Vayigash'", "ויגש"],
         ["'II Samuel.19-24'", "שמואל ב יט עד סופו"],
         ["'Psalms.107-119'", "תהלים קז עד קיט"],
         ["'Mishnah Kelim'", "כלים"]
       ],
       [
         ["'Parashat Vayechi'", "ויחי"],
         ["'I Kings.1-6'", "מלכים א א עד ו"],
         ["'Psalms.120-136'", "תהלים קכ עד קלו"],
         ["'Mishnah Bekhorot'", "בכורות"]
       ],
       [
         ["'Parashat Shemot'", "שמות"],
         ["'I Kings.7-10'", "מלכים א ז עד י"],
         ["'Psalms.137-150'", "תהלים קלז עד סופו"],
         ["'Mishnah Ta\\'anit', 'Mishnah Megillah'", "תענית<br>מגילה"]
       ],
       [
         ["'Parashat Vaera'", "וארא"],
         ["'I Kings.11-19'", "מלכים א יא עד יט"],
         ["'Job.1-6'", "איוב א עד ו"],
         ["'Mishnah Makkot'", "מכות"]
       ],
       [
         ["'Parashat Bo'", "בא"],
         ["'I Kings.20-22', 'II Kings.1-5'",
          "מלכים א כ עד סופו<br>מלכים ב א עד ה"],
         ["'Job.7-12'", "איוב ז עד יב"],
         ["'Mishnah Negaim'", "נגעים"]
       ],
       [
         ["'Parashat Beshalach'", "בשלח"],
         ["'II Kings.6-12'", "מלכים ב ו עד יב"],
         ["'Job.13-20'", "איוב יג עד כ"],
         ["'Mishnah Eruvin'", "ערובין"]
       ],
       [
         ["'Parashat Yitro'", "יתרו"],
         ["'II Kings.13-18'", "מלכים ב יג עד יח"],
         ["'Job.21-25'", "איוב כא עד כה"],
         ["'Pirkei Avot', 'Mishnah Avodah Zarah'", "אבות<br>עבודה זרה"]
       ],
       [
         ["'Parashat Mishpatim'", "משפטים"],
         ["'II Kings.19-25'", "מלכים ב יט עד סופו"],
         ["'Job.26-28'", "איוב כו עד כח"],
         ["'Mishnah Bava Kamma'", "בבא קמא"]
       ],
       [
         ["'Parashat Terumah'", "תרומה"],
         ["'Jeremiah.1-8'", "ירמיה א עד ח"],
         ["'Job.29-38'", "איוב כט עד לח"],
         ["'Mishnah Middot'", "מדות"]
       ],
       [
         ["'Parashat Tetzaveh'", "תצוה"],
         ["'Jeremiah.9-17'", "ירמיה ט עד יז"],
         ["'Job.39-42'", "איוב לט עד סופו"],
         ["'Mishnah Tevul Yom'", "טבול יום"]
       ],
       [
         ["'Parashat Ki Tisa'", "כי תשא"],
         ["'Jeremiah.18-31'", "ירמיה יח עד לא"],
         ["'Esther'", "אסתר"],
         ["'Mishnah Shekalim'", "שקלים"]
       ],
       [
         ["'Parashat Vayakhel'", "ויקהל"],
         ["'Jeremiah.32-37'", "ירמיה לב עד לז"],
         ["'Song of Songs'", "שיר השירים"],
         ["'Mishnah Shabbat'", "שבת"]
       ],
       [
         ["'Parashat Pekudei'", "פקודי"],
         ["'Jeremiah.38-49'", "ירמיה לח עד מט"],
         ["'Proverbs.1-6'", "משלי א עד ו"],
         ["'Mishnah Tahorot', 'Mishnah Yadayim'", "טהרות<br>ידים"]
       ],
       [
         ["'Parashat Vayikra'", "ויקרא"],
         ["'Jeremiah.50-52'", "ירמיה נ עד סופו"],
         ["'Proverbs.7-12'", "משלי ז עד יב"],
         ["'Mishnah Zevachim'", "זבחים"]
       ],
       [
         ["'Parashat Tzav'", "צו"],
         ["'Ezekiel.1-9'", "יחזקאל א עד ט"],
         ["'Proverbs.13-17'", "משלי יג עד ז"],
         ["'Mishnah Menachot'", "מנחות"]
       ],
       [
         ["'Parashat Shmini'", "שמיני"],
         ["'Ezekiel.10-17'", "יחזקאל י עד יז"],
         ["'Proverbs.18-22'", "משלי יח עד כב"],
         ["'Mishnah Chullin'", "חוֹלין"]
       ],
       [
         ["'Parashat Tazria'", "תזריע"],
         ["'Ezekiel.18-22'", "יחזקאל יח עד כב"],
         ["'Proverbs.23-27'", "משלי כג עד כז"],
         ["'Mishnah Niddah'", "נדה"]
       ],
       [
         ["'Parashat Metzora'", "טהור"],
         ["'Ezekiel.23-27'", "יחזקאל כג עד כז"],
         ["'Proverbs.28-30'", "משלי כח עד ל"],
         ["'Mishnah Zavim'", "זבים"]
       ],
       [
         ["'Parashat Achrei Mot'", "אחרי מות"],
         ["'Ezekiel.28-30'", "יחזקאל כג עד כז"],
         ["'Proverbs.31-31'", "משלי עד סופו"],
         ["'Mishnah Keritot'", "כריתות"]
       ],
       [
         ["'Parashat Kedoshim'", "קדושים"],
         ["'Ezekiel.31-40'", "יחזקאל לא עד מ"],
         ["'Daniel.1-3'", "דניאל א עד ג"],
         ["'Mishnah Orlah'", "ערלה"]
       ],
       [
         ["'Parashat Emor'", "אמור"],
         ["'Ezekiel.41-43'", "יחזקאל מא עד מג"],
         ["'Daniel.4-6'", "דניאל ד עד ו"],
         ["'Mishnah Beitzah', 'Mishnah Yoma'", "ביצה<br>יומא"]
       ],
       [
         ["'Parashat Behar'", "בהר"],
         ["'Ezekiel.44-46'", "יחזקאל מד עד מו"],
         ["'Daniel.7-8'", "דניאל ז עד ח"],
         ["'Mishnah Sheviit'", "שביעית"]
       ],
       [
         ["'Parashat Bechukotai'", "בחקתי"],
         ["'Ezekiel.47-48'", "יחזקאל מז עד סופו"],
         ["'Daniel.9-12'", "דניאל ט עד סופו"],
         ["'Mishnah Arakhin'", "ערכין"]
       ],
       [
         ["'Parashat Bamidbar'", "במדבר"],
         ["'Isaiah.1-5'", "ישעיה א עד ה"],
         ["'Ezra.1-5'", "עזרא א עד ה"],
         ["'Mishnah Makhshirin'", "מכשירין"]
       ],
       [
         ["'Parashat Nasso'", "נשא"],
         ["'Isaiah.6-9'", "ישעיה ו עד ט"],
         ["'Ruth'", "רות"],
         ["'Mishnah Nazir', 'Mishnah Sotah'", "נזיר<br>סוטה"]
       ],
       [
         ["'Parashat Beha\\'alotcha'", "בהעלתך"],
         ["'Isaiah.10-13'", "ישעיה י עד יג"],
         ["'Ezra.6-10'", "עזרא ו עד סופו"],
         ["'Mishnah Tamid'", "תמיד"]
       ],
       [
         ["'Parashat Sh\\'lach'", "שלח לך"],
         ["'Isaiah.14-20'", "ישעיה יד עד כ"],
         ["'Nehemiah.1-5'", "נחמיה א עד ה"],
         ["'Mishnah Challah'", "חלה"]
       ],
       [
         ["'Parashat Korach'", "קרח"],
         ["'Isaiah.21-24'", "ישעיה כא עד כד"],
         ["'Nehemiah.6-13'", "נחמיה ו עד סופו"],
         ["'Mishnah Terumot'", "תרומות"]
       ],
       [
         ["'Parashat Chukat'", "חקת"],
         ["'Isaiah.25-29'", "ישעיה כה עד כט"],
         ["'I Chronicles.1-5'", "דברי הימים א א עד ה"],
         ["'Mishnah Parah'", "פרה"]
       ],
       [
         ["'Parashat Balak'", "בלק"],
         ["'Isaiah.30-33'", "ישעיה ל עד לג"],
         ["'I Chronicles.6-11'", "דברי הימים א ו עד יא"],
         ["'Mishnah Oholot'", "אהלות"]
       ],
       [
         ["'Parashat Pinchas'", "פינחס"],
         ["'Isaiah.34-40'", "ישעיה לד עד מ"],
         ["'I Chronicles.12-17'", "דברי הימים א יב עד יז"],
         ["'Mishnah Bava Batra'", "בבא בתרא"]
       ],
       [
         ["'Parashat Matot'", "מטות"],
         ["'Isaiah.41-44'", "ישעיה מא עד מד"],
         ["'I Chronicles.18-23'", "דברי הימים א יח עד כג"],
         ["'Mishnah Nedarim'", "נדרים"]
       ],
       [
         ["'Parashat Masei'", "מסעי"],
         ["'Isaiah.45-49'", "ישעיה מה עד מט"],
         ["'I Chronicles.24-29'", "דברי הימים א כד עד סופו"],
         ["'Mishnah Eduyot'", "עדויות"]
       ],
       [
         ["'Parashat Devarim'", "דברים"],
         ["'Isaiah.50-58'", "ישעיה נ עד נח"],
         ["'Lamentations'", "איכה"],
         ["'Mishnah Bava Metzia'", "בבא מציעא"]
       ],
       [
         ["'Parashat Vaetchanan'", "ואתחנן"],
         ["'Isaiah.59-66'", "ישעיה נ עד סופו"],
         ["'II Chronicles.1-4'", "דברי הימים ב א עד ד"],
         ["'Mishnah Shevuot'", "שבועות"]
       ],
       [
         ["'Parashat Eikev'", "עקב"],
         ["'Hosea.1-5'", "הושע א עד ה"],
         ["'II Chronicles.5-8'", "דברי הימים ב ה עד ח"],
         ["'Mishnah Kilayim'", "כלאים"]
       ],
       [
         ["'Parashat Re\\'eh'", "ראה"],
         ["'Hosea.6-9'", "הושע ו עד ט"],
         ["'II Chronicles.9-14'", "דברי הימים ב ט עד יד"],
         ["'Mishnah Pesachim', 'Mishnah Rosh Hashanah', 'Mishnah Sukkah'",
          "פסחים<br>ראש השנה<br>סוכה"]
       ],
       [
         ["'Parashat Shoftim'", "שופטים"],
         ["'Hosea.10-14'", "הושע י עד סופו"],
         ["'II Chronicles.15-24'", "דברי הימים ב טו עד כד"],
         ["'Mishnah Sanhedrin'", "סנהדרין"]
       ],
       [
         ["'Parashat Ki Teitzei'", "כי תצא"],
         ["'Joel', 'Amos'", "יואל<br>עמוס"],
         ["'II Chronicles.25-27'", "דברי הימים ב כה עד כז"],
         ["'Mishnah Gittin'", "גיטין"]
       ],
       [
         ["'Parashat Ki Tavo'", "כי תבא"],
         ["'Obadiah', 'Jonah', 'Micah'", "עובדיה<br>יונה<br>מיכה"],
         ["'II Chronicles.28-34'", "דברי הימים ב כה עד לד"],
         // Mishnah Bikkurim from https://www.sefaria.org/api/v3/texts/Mishnah%20Bikkurim?version=source&return_format=strip_only_footnotes
         // returns only Chapter 4. I have no clue why
         ["'Mishnah Bikkurim'", "בכורים"]
       ],
       [
         ["'Parashat Nitzavim'", "נצבים"],
         ["'Nahum', 'Habakkuk', 'Zephaniah', 'Haggai'",
          "נחום<br>חבקוק<br>צפניה<br>חגי"],
         ["'II Chronicles.35-36'", "דברי הימים ב לה עד סופו"],
         ["'Mishnah Meilah'", "מעילה"]
       ],
       [
         ["'Parashat Vayeilech'", "וילך"],
         ["'Zechariah.1-11'", "זכריה א עד יא"],
         ["'Ecclesiastes.1-5'", "קהלת א עד ה"],
         ["'Mishnah Demai'", "דמאי"]
       ],
       [
         ["'Parashat Ha\\'Azinu'", "האזינו"],
         ["'Zechariah.12-14'", "זכריה יב עד סופו"],
         ["'Ecclesiastes.6-9'", "קהלת ו עד ט"],
         ["'Mishnah Oktzin'", "עוקצין"]
       ],
       [
         ["'Parashat V\\'Zot HaBerachah'", "וזאת הברכה"],
         ["'Malachi'", "מלאכי"],
         ["'Ecclesiastes.10-12'", "קהלת י עד סופו"],
         ["'Mishnah Temurah'", "תמורה"]
       ]
     ];

     function PopulateTable() {
       var table = document.getElementById("tableBody");

       Mishmara.forEach((row) => {
         var tr = document.createElement("tr");

         row.forEach((cell) => {
           var td = document.createElement("td");

           // use innerHTML for the button text so that we can pass in <br> etc.
           var button = document.createElement("button");
           button.className = "apiLink";
           button.setAttribute("onclick", "CallGetText([" + cell[0] + "]);");
           button.innerHTML = cell[1];
           td.appendChild(button)

           tr.appendChild(td);
         });
         table.appendChild(tr);
       });
     }

     function CallGetText(citations) {
       const options = {method: 'GET', headers: {accept: 'application/json'}};
       const baseUrl = "https://www.sefaria.org/api/v3/texts/";
       const params = "?version=source" +
                      "&return_format=strip_only_footnotes";

       var frame = document.getElementById("content");

       frame.replaceChildren();
       citations.forEach((citation, i) => {
         var url = baseUrl + citation + params;

         // Append the div to the container before calling the API to get its
         // content, because fetch is async and if we have more than one
         // citation the second one might finish before the first
         var contentDiv = document.createElement("div");
         contentDiv.className = "content-wrapper";
         frame.appendChild(contentDiv);

         fetch(url, options)
           .then(response => response.json())
           .then(response => WriteFrame(response, contentDiv))
           .catch(err => console.error(err));
       });
     }

     function WriteFrame(response, contentDiv) {
       // "sections" in the json give a reference to the beginning of the
       // returned text. If whole chapters are requested, the array is
       // length 1, and contains the first chapter. If the request begins
       // with a (possibly mid-chapter) verse, as it does implicitly when
       // making a request by parasha name, the array is length 2 and
       // includes chapter and verse.
       // sectionNames specifies the names of the units, but for our purposes
       // we can assume that they are always "chapter" and "verse" (or
       // "mishna", but that makes no practical difference at least for now)
       // We will use these for zero-based CSS counter-reset, so subtract 1
       var firstChapter = response.sections[0] - 1;
       var firstVerse =
         (response.sections.length > 1) ? response.sections[1] - 1: 0;

       // Create a heading for the text. Currently we are using the title
       // returned by the Sefaria API, which is not ideal: for example when
       // the citation is a parasha, it converts it to a from chapter and verse/
       // to chapter and verse citation, and that is what it returns as title
       var h2 = document.createElement("h2");
       h2.className = "textHeading";
       h2.appendChild(document.createTextNode(response.heRef));
       h2.style.counterReset = "chapter-number " + firstChapter;
       contentDiv.appendChild(h2);

       // For multi-chapter selection, "text" in the json is an array of
       // chapters each containing an array of verses. For single-chapter
       // selection, it is not an array with one member containing an array of
       // verses, which would be consistent, but just an array of verses. To
       // handle this we use a helper function to which we always pass an array
       // of verses: in the first case we do this by looping through the array
       // of chapters, and in the second case we just pass it "text"
       if (Array.isArray(response.versions[0].text[0])) {
         response.versions[0].text.forEach((chapter, j) => {
           contentDiv.appendChild(LayoutChapter(chapter, j, firstVerse));
         });
       } else {
         contentDiv.appendChild(LayoutChapter(response.versions[0].text, 0, 0));
       }
     }

     function LayoutChapter(chapter, chapterIndex, firstVerse) {
       var div = document.createElement("div");
       if (chapterIndex == 0 && firstVerse != 0) {
         // This handles the case where our selection begins mid-chapter,
         // so we need to start the verse numbering from the verse returned
         // in "sections[1]"
         div.style.counterReset = "verse-number " + firstVerse;
       }

       div.className = "chapter";
       var h3 = document.createElement("h3");
       h3.className = "chapterHeading";
       h3.appendChild(document.createTextNode("פרק"));
       div.appendChild(h3);

       // Here we use innerHTML instead of createTextNode, because there is
       // some embedded HTML in the text returned (which we style with CSS)
       chapter.forEach((verse) => {
         var span = document.createElement("span");
         span.className = "verse";
         span.innerHTML = verse;
         div.appendChild(span);
       });

       return div;
     }
    </script>
    <style type="text/css">
     /* Page layout */
     :root {
       color: white;
       background-color: black;
       direction: rtl;
     }
     #index-wrapper {
       box-sizing: border-box;
       float: right;
       width: 37vw;
       height: 100vh;
       position: fixed;
     }
     #index-title {
       height: 8vh;
     }
     #index  {
       height: 88vh;
       overflow-y: scroll;
     }
     .content-wrapper {
       margin-top: 0.6em;
     }
     .content-wrapper:first-child {
       margin-top: 0px
     }
     #content {
       box-sizing: border-box;
       float: left;
       height: 98vh;
       width: 61vw;
       padding: 0px 8px;
       overflow: scroll;
       border-style: solid;
     }
     thead { /* makes the table header fixed when scrolling */
       position:sticky;
       top:0;
       border-top:0;
       background: #cccccc;
     }

     /* Text styling */
     h1 {
       text-align: center;
       font-family: Stam Sefarad CLM, Stam Ashkenaz CLM, Guttman Stam;
       font-size: 32pt;
     }
     h2.textHeading {
       color: teal;
       font-size: 44pt;
       margin-top: 0em;
       margin-bottom: 0.4em;
     }
     h3.chapterHeading {
       font-size: 40pt;
       color: blue;
       margin-top: 0.4em;
       margin-bottom: 0.2em;
     }
     #content {
       font-size: 32pt;
       font-family: SBL Hebrew, Taamey David CLM, Taamey Frank CLM, SBL Hebrew;
       text-align: justify;
     }
     #index {
       font-size: 16pt;
     }
     button.apiLink {
       background-color: black;
       color: lime;
       border: none;
       text-decoration: underline;
       text-align: right;
       font-size: 16pt;
     }
     button.apiLink:hover {
       background-color: silver;
       cursor: pointer;
     }

     /* Styling for the classes in the text returned by Sefaria: */

     /* Ketiv */
     .mam-kq-k {
       font-size: smaller;
       color: red;
     }

     /* Qere */
     .mam-kq-q {
       color: green;
     }

     /* Parasha Setuma */
     .mam-spi-samekh:before {
       content: " ";
       margin-left: 1em;
     }

     .mam-spi-samekh:after {
       content: " ";
       margin-left: 1em;
     }

     /* Parasha Setuma and Petuha */
     .mam-spi-samekh, .mam-spi-pe
     {
       color: silver;
       font-size: smaller;
     }

     /* Sefaria returns arrays of text with no numbering.
        Define css counters to add chapter and verse numbering
        and also add some inter-verse spacing */
     div#content h2 {
       counter-reset: chapter-number;
     }

     div.chapter {
       counter-reset: verse-number;
     }

     h3.chapterHeading:after {
       counter-increment: chapter-number;
       content: counter(chapter-number, hebrew);
       margin-right: 0.25em;
     }

     span.verse:after {
       content: " ";
       margin-left: 0.2em;
     }
     span.verse:before {
       counter-increment: verse-number;
       content: counter(verse-number, hebrew);
       font-size: medium;
       margin-left: 1em;
     }
    </style>
  </head>
  <body onLoad="PopulateTable();">
    <div id="index-wrapper">
      <div id="index-title">
        <h1>משמרה</h1>
      </div>
      <div id="index">
        <table border 1">
          <thead>
            <tr>
              <th>פרשה</th>
              <th>נביאים</th>
              <th>כתובים</th>
              <th>משנה</th>
            </tr>
          </thead>
          <tbody id="tableBody">
          </tbody>
        </table>
      </div>
    </div>
    <div id="content">
      <div style="color: silver; font-size: smaller">
        <p>לחץ על אחד הקישורים בטבלה כדי לטעון קריאה</p>
        <p dir="ltr">Click one of the links in the table to download a reading</p>
      </div>
  </body>
</html>
